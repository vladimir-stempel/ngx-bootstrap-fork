{"version":3,"file":"bubble.js","sourceRoot":"","sources":["../../../../../src/chronos/duration/bubble.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,QAAQ,EAAE,MAAM,UAAU,CAAC;AACpC,OAAO,EAAE,OAAO,EAAE,MAAM,mBAAmB,CAAC;AAE5C,MAAM,UAAU,MAAM,CAAC,GAAa;IAClC,IAAI,YAAY,GAAG,GAAG,CAAC,aAAa,CAAC;IACrC,IAAI,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC;IACrB,IAAI,MAAM,GAAG,GAAG,CAAC,OAAO,CAAC;IACzB,MAAM,IAAI,GAAG,GAAG,CAAC,KAAK,CAAC;IAEvB,sEAAsE;IACtE,sDAAsD;IACtD,IAAI,CAAC,CAAC,CAAC,YAAY,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,MAAM,IAAI,CAAC,CAAC;QACjD,CAAC,YAAY,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,MAAM,IAAI,CAAC,CAAC,CAAC,EAAE;QACpD,YAAY,IAAI,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,GAAG,KAAK,CAAC;QAC7D,IAAI,GAAG,CAAC,CAAC;QACT,MAAM,GAAG,CAAC,CAAC;KACZ;IAED,0DAA0D;IAC1D,+BAA+B;IAC/B,IAAI,CAAC,YAAY,GAAG,YAAY,GAAG,IAAI,CAAC;IAExC,MAAM,OAAO,GAAG,QAAQ,CAAC,YAAY,GAAG,IAAI,CAAC,CAAC;IAC9C,IAAI,CAAC,OAAO,GAAG,OAAO,GAAG,EAAE,CAAC;IAE5B,MAAM,OAAO,GAAG,QAAQ,CAAC,OAAO,GAAG,EAAE,CAAC,CAAC;IACvC,IAAI,CAAC,OAAO,GAAG,OAAO,GAAG,EAAE,CAAC;IAE5B,MAAM,KAAK,GAAG,QAAQ,CAAC,OAAO,GAAG,EAAE,CAAC,CAAC;IACrC,IAAI,CAAC,KAAK,GAAG,KAAK,GAAG,EAAE,CAAC;IAExB,IAAI,IAAI,QAAQ,CAAC,KAAK,GAAG,EAAE,CAAC,CAAC;IAE7B,yBAAyB;IACzB,MAAM,cAAc,GAAG,QAAQ,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;IACpD,MAAM,IAAI,cAAc,CAAC;IACzB,IAAI,IAAI,OAAO,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC,CAAC;IAE9C,sBAAsB;IACtB,MAAM,KAAK,GAAG,QAAQ,CAAC,MAAM,GAAG,EAAE,CAAC,CAAC;IACpC,MAAM,IAAI,EAAE,CAAC;IAEb,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC;IAChB,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;IACpB,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;IAElB,OAAO,GAAG,CAAC;AACb,CAAC;AAED,MAAM,UAAU,YAAY,CAAC,GAAW;IACtC,mEAAmE;IACnE,oCAAoC;IACpC,OAAO,GAAG,GAAG,IAAI,GAAG,MAAM,CAAC;AAC7B,CAAC;AAED,MAAM,UAAU,YAAY,CAAC,KAAa;IACxC,8BAA8B;IAC9B,OAAO,KAAK,GAAG,MAAM,GAAG,IAAI,CAAC;AAC/B,CAAC","sourcesContent":["import { Duration } from './constructor';\r\nimport { absFloor } from '../utils';\r\nimport { absCeil } from '../utils/abs-ceil';\r\n\r\nexport function bubble(dur: Duration): Duration {\r\n  let milliseconds = dur._milliseconds;\r\n  let days = dur._days;\r\n  let months = dur._months;\r\n  const data = dur._data;\r\n\r\n  // if we have a mix of positive and negative values, bubble down first\r\n  // check: https://github.com/moment/moment/issues/2166\r\n  if (!((milliseconds >= 0 && days >= 0 && months >= 0) ||\r\n      (milliseconds <= 0 && days <= 0 && months <= 0))) {\r\n    milliseconds += absCeil(monthsToDays(months) + days) * 864e5;\r\n    days = 0;\r\n    months = 0;\r\n  }\r\n\r\n  // The following code bubbles up values, see the tests for\r\n  // examples of what that means.\r\n  data.milliseconds = milliseconds % 1000;\r\n\r\n  const seconds = absFloor(milliseconds / 1000);\r\n  data.seconds = seconds % 60;\r\n\r\n  const minutes = absFloor(seconds / 60);\r\n  data.minutes = minutes % 60;\r\n\r\n  const hours = absFloor(minutes / 60);\r\n  data.hours = hours % 24;\r\n\r\n  days += absFloor(hours / 24);\r\n\r\n  // convert days to months\r\n  const monthsFromDays = absFloor(daysToMonths(days));\r\n  months += monthsFromDays;\r\n  days -= absCeil(monthsToDays(monthsFromDays));\r\n\r\n  // 12 months -> 1 year\r\n  const years = absFloor(months / 12);\r\n  months %= 12;\r\n\r\n  data.day = days;\r\n  data.month = months;\r\n  data.year = years;\r\n\r\n  return dur;\r\n}\r\n\r\nexport function daysToMonths(day: number): number {\r\n  // 400 years have 146097 days (taking into account leap year rules)\r\n  // 400 years have 12 months === 4800\r\n  return day * 4800 / 146097;\r\n}\r\n\r\nexport function monthsToDays(month: number): number {\r\n  // the reverse of daysToMonths\r\n  return month * 146097 / 4800;\r\n}\r\n"]}