{"version":3,"file":"bs-datepicker-input.directive.js","sourceRoot":"","sources":["../../../../src/datepicker/bs-datepicker-input.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  ChangeDetectorRef,\r\n  Directive,\r\n  ElementRef,\r\n  forwardRef,\r\n  Host,\r\n  OnDestroy,\r\n  OnInit,\r\n  Provider,\r\n  Renderer2\r\n} from '@angular/core';\r\n\r\nimport {\r\n  AbstractControl,\r\n  ControlValueAccessor,\r\n  NG_VALIDATORS,\r\n  NG_VALUE_ACCESSOR,\r\n  ValidationErrors,\r\n  Validator\r\n} from '@angular/forms';\r\n\r\nimport {\r\n  formatDate,\r\n  getLocale,\r\n  isAfter,\r\n  isBefore,\r\n  isDate,\r\n  isDateValid,\r\n  parseDate,\r\n  utcAsLocal\r\n} from 'ngx-bootstrap/chronos';\r\n\r\nimport { BsDatepickerDirective } from './bs-datepicker.component';\r\nimport { BsLocaleService } from './bs-locale.service';\r\nimport { Subscription } from 'rxjs';\r\nimport { distinctUntilChanged } from 'rxjs/operators';\r\n\r\nconst BS_DATEPICKER_VALUE_ACCESSOR: Provider = {\r\n  provide: NG_VALUE_ACCESSOR,\r\n    useExisting: forwardRef(() => BsDatepickerInputDirective),\r\n  multi: true\r\n};\r\n\r\nconst BS_DATEPICKER_VALIDATOR: Provider = {\r\n  provide: NG_VALIDATORS,\r\n    useExisting: forwardRef(() => BsDatepickerInputDirective),\r\n  multi: true\r\n};\r\n\r\n@Directive({\r\n  selector: `input[bsDatepicker]`,\r\n  // eslint-disable-next-line @angular-eslint/no-host-metadata-property\r\n  host: {\r\n    '(change)': 'onChange($event)',\r\n    '(keyup.esc)': 'hide()',\r\n    '(keydown)': 'onKeydownEvent($event)',\r\n    '(blur)': 'onBlur()'\r\n  },\r\n  providers: [BS_DATEPICKER_VALUE_ACCESSOR, BS_DATEPICKER_VALIDATOR]\r\n})\r\nexport class BsDatepickerInputDirective\r\n  implements ControlValueAccessor, Validator, OnInit, OnDestroy {\r\n  private _onChange = Function.prototype;\r\n  private _onTouched = Function.prototype;\r\n    private _validatorChange = Function.prototype;\r\n  private _value: Date;\r\n  private _subs = new Subscription();\r\n\r\n  constructor(@Host() private _picker: BsDatepickerDirective,\r\n              private _localeService: BsLocaleService,\r\n              private _renderer: Renderer2,\r\n              private _elRef: ElementRef,\r\n              private changeDetection: ChangeDetectorRef) {}\r\n\r\n  ngOnInit() {\r\n    // update input value on datepicker value update\r\n    this._subs.add(\r\n      this._picker.bsValueChange.subscribe((value: Date) => {\r\n        this._setInputValue(value);\r\n        if (this._value !== value) {\r\n          this._value = value;\r\n          this._onChange(value);\r\n          this._onTouched();\r\n        }\r\n        this.changeDetection.markForCheck();\r\n      })\r\n    );\r\n\r\n    // update input value on locale change\r\n    this._subs.add(\r\n      this._localeService.localeChange.subscribe(() => {\r\n        this._setInputValue(this._value);\r\n      })\r\n    );\r\n\r\n    this._subs.add(\r\n    this._picker.dateInputFormat$.pipe(distinctUntilChanged()).subscribe(() => {\r\n      this._setInputValue(this._value);\r\n    })\r\n  );\r\n}\r\n\r\n  ngOnDestroy() {\r\n    this._subs.unsubscribe();\r\n  }\r\n\r\n  onKeydownEvent(event) {\r\n    if (event.keyCode === 13 || event.code === 'Enter') {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n  _setInputValue(value: Date): void {\r\n    const initialDate = !value ? ''\r\n      : formatDate(value, this._picker._config.dateInputFormat, this._localeService.currentLocale);\r\n\r\n    this._renderer.setProperty(this._elRef.nativeElement, 'value', initialDate);\r\n  }\r\n\r\n  onChange(event: Event) {\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    this.writeValue((event.target as any).value);\r\n    this._onChange(this._value);\r\n    if (this._picker._config.returnFocusToInput) {\r\n      this._renderer.selectRootElement(this._elRef.nativeElement).focus();\r\n    }\r\n    this._onTouched();\r\n  }\r\n\r\n  validate(c: AbstractControl): ValidationErrors | null {\r\n    const _value: Date | string = c.value;\r\n\r\n        if (_value === null || _value === undefined || _value === '') {\r\n      return null;\r\n    }\r\n\r\n    if (isDate(_value)) {\r\n      const _isDateValid = isDateValid(_value);\r\n      if (!_isDateValid) {\r\n        return { bsDate: { invalid: _value } };\r\n      }\r\n\r\n      if (this._picker && this._picker.minDate && isBefore(_value, this._picker.minDate, 'date')) {\r\n        this.writeValue(this._picker.minDate);\r\n\r\n        return { bsDate: { minDate: this._picker.minDate } };\r\n      }\r\n\r\n      if (this._picker && this._picker.maxDate && isAfter(_value, this._picker.maxDate, 'date')) {\r\n        this.writeValue(this._picker.maxDate);\r\n\r\n        return { bsDate: { maxDate: this._picker.maxDate } };\r\n      }\r\n    }\r\n  }\r\n\r\n  registerOnValidatorChange(fn: () => void): void {\r\n    this._validatorChange = fn;\r\n  }\r\n\r\n  writeValue(value: Date | string) {\r\n    if (!value) {\r\n      this._value = null;\r\n    } else {\r\n      const _localeKey = this._localeService.currentLocale;\r\n      const _locale = getLocale(_localeKey);\r\n      if (!_locale) {\r\n        throw new Error(\r\n          `Locale \"${_localeKey}\" is not defined, please add it with \"defineLocale(...)\"`\r\n        );\r\n      }\r\n\r\n      this._value = parseDate(value, this._picker._config.dateInputFormat, this._localeService.currentLocale);\r\n\r\n      if (this._picker._config.useUtc) {\r\n        this._value = utcAsLocal(this._value);\r\n      }\r\n    }\r\n\r\n    this._picker.bsValue = this._value;\r\n  }\r\n\r\n  setDisabledState(isDisabled: boolean): void {\r\n    this._picker.isDisabled = isDisabled;\r\n    if (isDisabled) {\r\n      this._renderer.setAttribute(this._elRef.nativeElement, 'disabled', 'disabled');\r\n\r\n      return;\r\n    }\r\n    this._renderer.removeAttribute(this._elRef.nativeElement, 'disabled');\r\n  }\r\n\r\n  registerOnChange(fn: () => void): void {\r\n    this._onChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: () => void): void {\r\n    this._onTouched = fn;\r\n  }\r\n\r\n  onBlur() {\r\n    this._onTouched();\r\n  }\r\n\r\n  hide() {\r\n    this._picker.hide();\r\n    this._renderer.selectRootElement(this._elRef.nativeElement).blur();\r\n    if (this._picker._config.returnFocusToInput) {\r\n      this._renderer.selectRootElement(this._elRef.nativeElement).focus();\r\n    }\r\n  }\r\n}\r\n"]}